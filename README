N.B.: This is far from perfect and is known to indent in crazy ways sometimes.
